import { computeInputFields, InputField } from '../../utils/computeInputFields';

describe('computeInputFields', () => {
  test('should create Person input fields properly', () => {
    const personNode = {
      nameSingular: 'person',
      namePlural: 'people',
      labelSingular: 'Person',
      labelPlural: 'People',
      description: 'A person',
      isCustom: false,
      labelIdentifierFieldMetadataId: null,
      imageIdentifierFieldMetadataId: null,
      fields: {
        edges: [
          {
            node: {
              id: '2e996a11-16ab-4b35-8001-4464cb9e75be',
              type: 'RELATION',
              name: 'favorites',
              label: 'Favorites',
              description: 'Favorites linked to the contact',
              icon: 'IconHeart',
              isCustom: false,
              isActive: true,
              targetColumnMap: {},
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: {
                id: 'c661edf8-562f-4de0-91d0-359026850609',
                relationType: 'ONE_TO_MANY',
                toFieldMetadataId: '59288ec7-507f-479a-b3fe-de04b942869c',
                toObjectMetadata: {
                  id: '38f9a7a3-886c-48f1-ac98-e43484897b0c',
                  dataSourceId: '9e108960-1c37-4161-9dc9-3c98a805ac5a',
                  nameSingular: 'favorite',
                  namePlural: 'favorites',
                  isSystem: true,
                },
              },
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '404d08ed-cbd3-40e2-8944-cccc2b8b8f13',
              type: 'TEXT',
              name: 'jobTitle',
              label: 'Job Title',
              description: 'Contact’s job title',
              icon: 'IconBriefcase',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'jobTitle',
              },
              isSystem: false,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                value: '',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '4fc4905a-506b-4c80-aef4-3b0591863af0',
              type: 'RELATION',
              name: 'company',
              label: 'Company',
              description: 'Contact’s company',
              icon: 'IconBuildingSkyscraper',
              isCustom: false,
              isActive: true,
              targetColumnMap: {},
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: {
                id: '6bf639b4-8522-411c-8c23-7c3cf7fc8a63',
                relationType: 'ONE_TO_MANY',
                fromFieldMetadataId: '74bf38ec-ea14-4a86-bb18-6440a5994f5f',
                fromObjectMetadata: {
                  id: 'aed2ca2b-4621-483b-898d-e002115fca50',
                  dataSourceId: '9e108960-1c37-4161-9dc9-3c98a805ac5a',
                  nameSingular: 'company',
                  namePlural: 'companies',
                  isSystem: false,
                },
              },
            },
          },
          {
            node: {
              id: '5ca21f07-21ab-4411-b1f9-7e68f0f1f5c6',
              type: 'DATE_TIME',
              name: 'updatedAt',
              label: 'Update date',
              description: null,
              icon: 'IconCalendar',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'updatedAt',
              },
              isSystem: true,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                type: 'now',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '7b8d31b4-7f71-4a2a-91c5-21e22b16c14c',
              type: 'FULL_NAME',
              name: 'name',
              label: 'Name',
              description: 'Contact’s name',
              icon: 'IconUser',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                lastName: 'nameLastName',
                firstName: 'nameFirstName',
              },
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                lastName: '',
                firstName: '',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '7b97387a-85a0-483e-8c87-b20df9607875',
              type: 'UUID',
              name: 'id',
              label: 'Id',
              description: null,
              icon: null,
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'id',
              },
              isSystem: true,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                type: 'uuid',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '89c543e9-015e-4a49-a536-c819bf55211f',
              type: 'TEXT',
              name: 'city',
              label: 'City',
              description: 'Contact’s city',
              icon: 'IconMap',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'city',
              },
              isSystem: false,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                value: '',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '8d3167b6-18b5-4703-b172-c4d1802da90f',
              type: 'NUMBER',
              name: 'recordPosition',
              label: 'RecordPosition',
              description: 'Record Position',
              icon: 'IconHierarchy2',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'recordPosition',
              },
              isSystem: true,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '9a257ec0-c3f4-4109-8bc4-057b13760d33',
              type: 'LINK',
              name: 'xLink',
              label: 'X',
              description: 'Contact’s X/Twitter account',
              icon: 'IconBrandX',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                url: 'xLinkUrl',
                label: 'xLinkLabel',
              },
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '9d282616-d6db-4125-8f9f-d4b972a8ce36',
              type: 'LINK',
              name: 'linkedinLink',
              label: 'Linkedin',
              description: 'Contact’s Linkedin account',
              icon: 'IconBrandLinkedin',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                url: 'linkedinLinkUrl',
                label: 'linkedinLinkLabel',
              },
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: '9eed8161-3a05-4953-835b-384cf089a032',
              type: 'TEXT',
              name: 'avatarUrl',
              label: 'Avatar',
              description: 'Contact’s avatar',
              icon: 'IconFileUpload',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'avatarUrl',
              },
              isSystem: true,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                value: '',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'b1038848-118c-4e95-9845-1df84ab0d6c1',
              type: 'EMAIL',
              name: 'email',
              label: 'Email',
              description: 'Contact’s Email',
              icon: 'IconMail',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'email',
              },
              isSystem: false,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                value: '',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'bff013de-ebeb-451c-ab62-bc09ac9134b1',
              type: 'UUID',
              name: 'companyId',
              label: 'Company id (foreign key)',
              description: 'Contact’s company id foreign key',
              icon: 'IconBuildingSkyscraper',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'companyId',
              },
              isSystem: true,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'c92ee75e-4a5c-475f-a596-1b3d51891504',
              type: 'RELATION',
              name: 'attachments',
              label: 'Attachments',
              description: 'Attachments linked to the contact.',
              icon: 'IconFileImport',
              isCustom: false,
              isActive: true,
              targetColumnMap: {},
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: {
                id: '0c7e25fd-bc21-4152-b164-ba1aae6a476f',
                relationType: 'ONE_TO_MANY',
                toFieldMetadataId: '8ead5ae5-695b-432d-988e-072c499ede4c',
                toObjectMetadata: {
                  id: 'fc17ae97-8260-4bc2-b3fc-77b9bc48ac9f',
                  dataSourceId: '9e108960-1c37-4161-9dc9-3c98a805ac5a',
                  nameSingular: 'attachment',
                  namePlural: 'attachments',
                  isSystem: true,
                },
              },
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'cba1e2e8-3f7a-469d-938a-3a49ac196e26',
              type: 'RELATION',
              name: 'activityTargets',
              label: 'Activities',
              description: 'Activities tied to the contact',
              icon: 'IconCheckbox',
              isCustom: false,
              isActive: true,
              targetColumnMap: {},
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: {
                id: '7e3103b1-cad8-4888-84e6-85bad06cf9e2',
                relationType: 'ONE_TO_MANY',
                toFieldMetadataId: 'e90aadb4-3e46-4c84-a195-abf4d5a11cd7',
                toObjectMetadata: {
                  id: 'ea33d1d2-3837-4c22-81be-2b9524150d45',
                  dataSourceId: '9e108960-1c37-4161-9dc9-3c98a805ac5a',
                  nameSingular: 'activityTarget',
                  namePlural: 'activityTargets',
                  isSystem: true,
                },
              },
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'df5afaae-ecd0-4ca3-8a02-09926739bb09',
              type: 'DATE_TIME',
              name: 'createdAt',
              label: 'Creation date',
              description: null,
              icon: 'IconCalendar',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'createdAt',
              },
              isSystem: false,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                type: 'now',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'e5c4dc88-c95a-42dd-807a-f515a5d1bac8',
              type: 'TEXT',
              name: 'phone',
              label: 'Phone',
              description: 'Contact’s phone number',
              icon: 'IconPhone',
              isCustom: false,
              isActive: true,
              targetColumnMap: {
                value: 'phone',
              },
              isSystem: false,
              isNullable: false,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: {
                value: '',
              },
              options: null,
              fromRelationMetadata: null,
              toRelationMetadata: null,
            },
          },
          {
            node: {
              id: 'fce4d23d-1f65-4cae-863f-712ffe319438',
              type: 'RELATION',
              name: 'pointOfContactForOpportunities',
              label: 'POC for Opportunities',
              description: 'Point of Contact for Opportunities',
              icon: 'IconTargetArrow',
              isCustom: false,
              isActive: true,
              targetColumnMap: {},
              isSystem: false,
              isNullable: true,
              createdAt: '2024-02-02T09:14:40.405Z',
              updatedAt: '2024-02-02T09:14:40.405Z',
              defaultValue: null,
              options: null,
              fromRelationMetadata: {
                id: 'bc7c6482-0aaf-458c-a809-61de4837dd75',
                relationType: 'ONE_TO_MANY',
                toFieldMetadataId: '9e1cc843-adb0-4443-88f5-8cb6f0bfc371',
                toObjectMetadata: {
                  id: 'd5791180-a1d5-4825-8298-b71107dfc5db',
                  dataSourceId: '9e108960-1c37-4161-9dc9-3c98a805ac5a',
                  nameSingular: 'opportunity',
                  namePlural: 'opportunities',
                  isSystem: false,
                },
              },
              toRelationMetadata: null,
            },
          },
        ],
      },
    };
    const baseExpectedResult: InputField[] = [
      {
        key: 'jobTitle',
        label: 'Job Title',
        type: 'string',
        helpText: 'Contact’s job title',
        required: false,
      },
      {
        key: 'updatedAt',
        label: 'Update date',
        type: 'datetime',
        helpText: null,
        required: false,
      },
      {
        key: 'name__lastName',
        label: 'Name (LastName)',
        type: 'string',
        helpText: 'Contact’s name (lastName)',
        required: false,
      },
      {
        key: 'name__firstName',
        label: 'Name (FirstName)',
        type: 'string',
        helpText: 'Contact’s name (firstName)',
        required: false,
      },
      {
        key: 'city',
        label: 'City',
        type: 'string',
        helpText: 'Contact’s city',
        required: false,
      },
      {
        key: 'recordPosition',
        label: 'RecordPosition',
        type: 'integer',
        helpText: 'Record Position',
        required: false,
      },
      {
        key: 'xLink__url',
        label: 'X (Url)',
        type: 'string',
        helpText: 'Contact’s X/Twitter account (url)',
        required: false,
      },
      {
        key: 'xLink__label',
        label: 'X (Label)',
        type: 'string',
        helpText: 'Contact’s X/Twitter account (label)',
        required: false,
      },
      {
        key: 'linkedinLink__url',
        label: 'Linkedin (Url)',
        type: 'string',
        helpText: 'Contact’s Linkedin account (url)',
        required: false,
      },
      {
        key: 'linkedinLink__label',
        label: 'Linkedin (Label)',
        type: 'string',
        helpText: 'Contact’s Linkedin account (label)',
        required: false,
      },
      {
        key: 'avatarUrl',
        label: 'Avatar',
        type: 'string',
        helpText: 'Contact’s avatar',
        required: false,
      },
      {
        key: 'email',
        label: 'Email',
        type: 'string',
        helpText: 'Contact’s Email',
        required: false,
      },
      {
        key: 'companyId',
        label: 'Company id (foreign key)',
        type: 'string',
        helpText: 'Contact’s company id foreign key',
        required: false,
      },
      {
        key: 'createdAt',
        label: 'Creation date',
        type: 'datetime',
        helpText: null,
        required: false,
      },
      {
        key: 'phone',
        label: 'Phone',
        type: 'string',
        helpText: 'Contact’s phone number',
        required: false,
      },
    ];
    const idInputField: InputField = {
      key: 'id',
      label: 'Id',
      type: 'string',
      helpText: null,
      required: false,
    };
    const expectedResult = [idInputField].concat(baseExpectedResult);
    expect(computeInputFields(personNode)).toEqual(expectedResult);
    idInputField.required = true;
    const idRequiredExpectedResult = [idInputField].concat(baseExpectedResult);
    expect(computeInputFields(personNode, true)).toEqual(
      idRequiredExpectedResult,
    );
  });
});
